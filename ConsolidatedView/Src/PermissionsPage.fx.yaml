PermissionsPage As screen:
    OnVisible: |-
        =UpdateContext({activeAccordian: -1});

    PermissionPageContainer As groupContainer.verticalAutoLayoutContainer:
        DropShadow: =DropShadow.None
        Height: =Parent.Height
        LayoutDirection: =LayoutDirection.Vertical
        LayoutMode: =LayoutMode.Auto
        LayoutOverflowY: =LayoutOverflow.Scroll
        Width: =Parent.Width
        ZIndex: =3

        PermissionPageMenu As PageMenu:
            Height: =60
            LayoutMinHeight: =640
            Width: =Parent.Width

        Accordian As gallery.variableTemplateHeightGallery:
            DelayItemLoading: =true
            Height: |-
                =Sum(
                    Self.AllItems,
                    AccordianItemHeight.Text
                )+10
            Items: |-
                =Table({
                  id: 1,
                  title: "Business details",
                  subTitle: "Permission level is Full permission",
                  levels: Table({
                    title: "View",
                    permissions: ["View business details", "View people associated with the business"]
                  },{
                    title: "Amend",
                    permissions: ["...", "..."],
                    selected: true
                  })
                },{
                  id: 2,
                  title: "Some details",
                  subTitle: "Permission level is Half permission",
                  levels: Table({
                    title: "View",
                    permissions: ["Permission 1", "Permission 2"]
                  },{
                    title: "Amend",
                    permissions: ["...", "..."],
                    selected: true
                  },{
                    title: "Make Legal changes",
                    permissions: ["...", "..."]
                  })
                })
            Layout: =Layout.Vertical
            LoadingSpinner: =LoadingSpinner.Data
            TemplatePadding: =10
            TemplateSize: =280
            Width: |
                =Parent.Width
            ZIndex: =4

            AccordianContainer As groupContainer.verticalAutoLayoutContainer:
                DropShadow: =DropShadow.None
                Height: =If(ThisItem.id = activeAccordian, 450, 41)
                LayoutDirection: =LayoutDirection.Vertical
                LayoutMode: =LayoutMode.Auto
                Width: =Parent.Width - (Accordian.TemplatePadding * 2)
                ZIndex: =2

                AccordianButtonContainer As groupContainer.horizontalAutoLayoutContainer:
                    DropShadow: =DropShadow.None
                    Height: =40
                    LayoutMode: =LayoutMode.Auto
                    PaddingLeft: =10
                    ZIndex: =1

                    CloseIcon As icon.ChevronUp:
                        Height: =40
                        Icon: =Icon.ChevronUp
                        Visible: =If(ThisItem.id = activeAccordian, true, false)
                        Width: =20
                        ZIndex: =1

                    OpenIcon As icon.ChevronDown:
                        Height: =40
                        Icon: =Icon.ChevronDown
                        Visible: =If(ThisItem.id = activeAccordian, false, true)
                        Width: =20
                        ZIndex: =2

                    AccordianButton As button:
                        Align: =Align.Left
                        BorderThickness: =0
                        Color: =RGBA(0, 0, 0, 1)
                        DisabledBorderColor: =Self.Color
                        DisabledColor: =Self.Color
                        DisabledFill: =
                        Fill: =RGBA(255, 255, 255, 0)
                        FocusedBorderThickness: =0
                        HoverColor: =Self.Color
                        HoverFill: =Self.Fill
                        OnSelect: |-
                            =If(activeAccordian = ThisItem.id, UpdateContext({activeAccordian: -1}), UpdateContext({activeAccordian: ThisItem.id}))
                        PaddingLeft: =15
                        PressedColor: =Self.Color
                        PressedFill: =Self.Fill
                        Text: =ThisItem.title
                        Width: =Parent.Width - OpenIcon.Width
                        ZIndex: =3

                AccordianTitleBodySeperator As rectangle:
                    Fill: =RGBA(214, 221, 224, 1)
                    Height: =1
                    Width: =Parent.Width
                    ZIndex: =2

                AccordianBodySubTitleLabel As label:
                    Text: =ThisItem.subTitle
                    Visible: =ThisItem.id = activeAccordian
                    Width: =Parent.Width
                    ZIndex: =3

                AccordianBody As gallery.galleryHorizontal:
                    DelayItemLoading: =true
                    Height: =Parent.Height - AccordianButton.Height - 50
                    Items: =ThisItem.levels
                    LoadingSpinner: =LoadingSpinner.Data
                    TemplateSize: =AccordianBodyContainer.Width
                    Visible: =ThisItem.id = activeAccordian
                    Width: =Parent.Width
                    ZIndex: =4

                    AccordianBodyContainer As groupContainer.verticalAutoLayoutContainer:
                        DropShadow: =DropShadow.None
                        Fill: =If(ThisItem.Selected = true, RGBA(235, 235, 235, 1), RGBA(235, 235, 235, 1))
                        Height: =Parent.Height
                        LayoutDirection: =LayoutDirection.Vertical
                        LayoutGap: =10
                        LayoutMode: =LayoutMode.Auto
                        PaddingBottom: =10
                        PaddingLeft: =20
                        PaddingRight: =20
                        PaddingTop: =10
                        Width: =300
                        ZIndex: =3

                        AccordianBodyTitle As label:
                            AutoHeight: =true
                            OnSelect: =
                            PaddingLeft: =0
                            PaddingRight: =0
                            Text: =ThisItem.title
                            Width: =Parent.Width
                            X: =40
                            Y: =40
                            ZIndex: =1

                        AccordianBodySeperator As rectangle:
                            Fill: =RGBA(199, 199, 199, 1)
                            Height: =1
                            Width: =Parent.Width - AccordianBodyContainer.PaddingLeft - AccordianBodyContainer.PaddingRight
                            ZIndex: =2

                        AccordianBodyContent As label:
                            AutoHeight: =true
                            OnSelect: =
                            PaddingLeft: =0
                            PaddingTop: =20
                            Text: =Concat(ThisItem.permissions, Value & Char(13) & Char(13))
                            Width: =Parent.Width - AccordianBodyContainer.PaddingRight
                            X: =20
                            Y: =20
                            ZIndex: =3

            AccordianItemHeight As label:
                Text: =AccordianContainer.Height
                Visible: =false
                ZIndex: =3

